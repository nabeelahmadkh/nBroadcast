<!DOCTYPE html>
<html lang="en">

  <head>

    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta name="description" content="">
    <meta name="author" content="">

    <title>NBroadcast</title>
    <link rel="shortcut icon" href="https://firebasestorage.googleapis.com/v0/b/blogproject-f3538.appspot.com/o/blog-images%2Fbroadcast-16*16-light.png?alt=media&token=529479bf-ba2b-4fab-912c-3410ac6441d9" type="image/x-icon">

    <!-- Bootstrap core CSS -->
    <link href="../bootstrap.min.css" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.11.0/umd/popper.min.js" type="text/javascript"></script>
    <!-- Custom styles for this template -->
    <link href="../blog-home.css" rel="stylesheet">

  </head>
 
  <body>

    <!-- Navigation -->
    <nav class="navbar navbar-expand-lg navbar-dark bg-dark fixed-top">
      <div class="container">
        <img alt="nbroadcast-logo" width="3%" height="3%" src="https://firebasestorage.googleapis.com/v0/b/blogproject-f3538.appspot.com/o/blog-images%2Fbroadcast-512*512.png?alt=media&token=7f0304be-bddb-4afa-8cc5-1d80a283e718" >&nbsp;
        <a class="navbar-brand" href="/">NBroadcast.me</a>
        <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarResponsive" aria-controls="navbarResponsive" aria-expanded="false" aria-label="Toggle navigation">
          <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse" id="navbarResponsive">
          <ul class="navbar-nav ml-auto">
            <li class="nav-item">
              <a class="nav-link" href="/">Home
              </a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="/about">About</a>
            </li>
            {{#if user}}
            <li class="nav-item">
              <div class="dropdown">
                <button class="nav-link btn btn-secondary dropdown-toggle" type="button" id="dropdownMenuButton" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false" style="color:white">
                  {{user}}
                </button>
                <div class="dropdown-menu" aria-labelledby="dropdownMenuButton">
                  <a class="nav-link dropdown-item" href="/logout" style="color:black">LogOut</a>
                </div>
              </div>
            </li>
            {{else}}
            <li class="nav-item">
              <a class="nav-link" href="/login">Login</a>
            </li>
            {{/if}}
          </ul>
        </div>
      </div>
    </nav>

    <!-- Page Content -->
    <div class="container">

      <div class="row">

        <!-- Blog Entries Column -->
        <div class="col-md-8">

          <h1 class="my-4">{{title}}
            <small>{{title2}}</small>
          </h1>

          <!-- Blog Post -->
          <div class="card mb-4">
            <div class="card-body">
              {{{content}}}  
            </div>
            <div class="card-footer text-muted">
              Tags : 
              {{#each tags}}
                <a href="#" onclick="return false;">{{this}}, </a>
              {{/each}}
            </div>
            <div class="card-footer text-muted">
              Posted on {{date}} by
              <a href="/about">{{author}}</a>
            </div>
          </div>

          <div class="card mb-4">
            <div class="card-body">
              <form>
                <label for="exampleFormControlTextarea1"><b>Leave a Reply:</b></label>
                <textarea class="form-control form-control-sm" id="userComment" placeholder="Comment:" rows="3" name="comment"></textarea>
                <input class="form-control form-control-sm margin-top" type="text" placeholder="Name:" name="name" id="userName">
                <input type="hidden" value={{postId}} name="postId" />
                <button type="button" class="btn btn-success margin-top" onclick="add_comment('{{postId}}')">Submit</button>
              </form> 
            </div>

            <div id="comments">
              {{#each comments}}
                <div class="panel-body" id="singleComment">
                  <hr>
                  <ul class="media-list" id="commentList">
                    <li class="media">
                      <a href="#" class="pull-left">
                        <img src="https://bootdey.com/img/Content/user_1.jpg" alt="" class="img-circle">
                      </a>
                      <div class="media-body">
                        <span class="text-muted pull-right">
                          <small class="text-muted">{{date}}</small>
                        </span>
                        <strong class="text-success">@{{name}}</strong>
                        <p>
                          {{value}}
                        </p>
                      </div>
                    </li>
                  </ul>
                </div>
              {{/each}}
            </div>

          </div>

          

        </div>

        <!-- Sidebar Widgets Column -->
        <div class="col-md-4">

          <!-- Search Widget -->
          <form action="/search" method="get">
            <div class="card my-4">
              <h5 class="card-header">Search</h5>
              <div class="card-body">
                <div class="input-group">
                  <input type="text" class="form-control" placeholder="Search for..." name="searchquery">
                  <span class="input-group-btn">
                    <button class="btn btn-secondary" type="submit" value="Submit">Go!</button>
                  </span>
                </div>
              </div>
            </div>
          </form>

          <!-- Categories Widget -->
          <div class="card my-4">
            <h5 class="card-header">Categories</h5>
            <div class="card-body">
              <div class="row">
                <div class="col-lg-6">
                  <ul class="list-unstyled mb-0">
                    <li>
                      <a href="/category?category=hardware">Comp. Hardware</a>
                    </li>
                    <li>
                      <a href="/category?category=machinelearning">Machine Learning</a>
                    </li>
                    <li>
                      <a href="/category?category=problemsolving">Problem Solving</a>
                    </li>
                  </ul>
                </div>
                <div class="col-lg-6">
                  <ul class="list-unstyled mb-0">
                    <li>
                      <a href="/category?category=softwareengineering">Software Engg</a>
                    </li>
                    <li>
                      <a href="/category?category=microsoftit">Microsoft IT</a>
                    </li>
                  </ul>
                </div>
              </div>
            </div>
          </div>

          <!-- Side Widget -->
          <div class="card my-4">
            <h5 class="card-header">Popular Posts</h5>
            <div class="card-body">
              <ul>
              {{#each sidebar}}
                <li><a href="/viewpost?post={{key}}">{{title}}</a></li>
              {{/each}}
              </ul>
            </div>
          </div>

          <!-- Side Widget -->
          <div class="card my-4">
            <h5 class="card-header">All Posts by Date</h5>
            <div class="card-body">
              <ul>
                {{#each postByDate}}
                <li>
                  <a href="javascript:void(0);" onclick="display_hidden_month({{year}});">{{year}}</a>
                  <ul>
                    {{#each month}}
                    <li id="monthbydate{{../year}}" style="display:none;">
                      <a href="javascript:void(0);" onclick="display_hidden_post('{{../year}}{{name}}')">{{this.name}}</a>
                      <ul id="postbydate{{../year}}{{name}}" style="display:none;">
                        {{#each post}}
                        <li>
                          <a href="/viewpost?post={{this.key}}">{{this.name}}</a>
                        </li>
                        {{/each}}
                      </ul>
                    </li>
                    {{/each}}
                  </ul>
                </li>
                {{/each}}
              </ul>
            </div>
          </div>

        </div>

      </div>
      <!-- /.row -->

    </div>
    <!-- /.container -->

    <!-- Footer -->
    <footer class="py-5 bg-dark">
      <div class="container">
        <p class="m-0 text-center text-white">Copyright &copy; NBroadcast 2019</p>
      </div>
      <!-- /.container -->
    </footer>

    <!-- Bootstrap core JavaScript -->
    {{!-- <script src="vendor/jquery/jquery.min.js"></script>
    <script src="vendor/bootstrap/js/bootstrap.bundle.min.js"></script> --}}
    <script src="https://cdn.rawgit.com/google/code-prettify/master/loader/run_prettify.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-beta/js/bootstrap.min.js"></script>
    <script>
      function display_hidden_month(year)
      {
          if (document.getElementById("monthbydate"+year).style.display == "block"){
            document.getElementById("monthbydate"+year).style.display = "none"
          }
          else{
            document.getElementById("monthbydate"+year).style.display = "block"
          }
      }
    </script>
    <script>
      function display_hidden_post(yearMonth)
      {
          if (document.getElementById("postbydate"+yearMonth).style.display == "block"){
            document.getElementById("postbydate"+yearMonth).style.display = "none"
          }
          else{
            document.getElementById("postbydate"+yearMonth).style.display = "block"
          }
      }
    </script>
    <script>
      function add_comment(postId){
        console.log("post id is ", postId);
        console.log("name is ", document.getElementById('userName').value);
        console.log("comment is ", document.getElementById('userComment').value);
        
        var newComment = {
          "postId": postId,
          "name" : document.getElementById('userName').value,
          "comment" : document.getElementById('userComment').value
        };
      
        var currentDate = new Date();
        const monthNames = ["Jan", "Feb", "Mar", "Apr", "May", "Jun",
                            "Jul", "Aug", "Sep", "Oct", "Nov", "Dec"];
        $.ajax(
                {
                    type: 'POST',
                    url: 'http://localhost:3000/addcomment',
                    dataType: 'json',
                    data: JSON.stringify(newComment),
                    contentType: 'application/json',
                    success: function (data) {
                      $('#comments').prepend('<div class="panel-body"><hr><ul class="media-list" id="commentList"><li class="media"><a href="#" class="pull-left"><img src="https://bootdey.com/img/Content/user_1.jpg" alt="" class="img-circle"></a><div class="media-body"><span class="text-muted pull-right"><small class="text-muted">' + currentDate.getDate() + '-' + monthNames[currentDate.getMonth()] + '-' + currentDate.getFullYear() + '</small></span><strong class="text-success">@' + document.getElementById('userName').value + '</strong><p> ' + document.getElementById('userComment').value + ' </p></div></li></ul></div>')
                      $('#userComment').val('');
                      $('#userName').val('');
                    },
                    error: function (msg, url, line) {
                        alert('error trapped in error: function(msg, url, line)');
                        alert('msg = ' + msg + ', url = ' + url + ', line = ' + line);
                    }
                });
      }
    </script>
  </body>

</html>
